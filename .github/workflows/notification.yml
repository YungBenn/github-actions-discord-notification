name: Notification

on:
  push:
    branches: [master]
  workflow_dispatch:

env:
  PRODUCTION_DOMAIN: ssc.sportgather.com

jobs:
  notify-success:
    name: Success Notification
    runs-on: ubuntu-latest
    steps:
      - name: Notify Discord - Success
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_USERNAME: "SportGather CI/CD"
          DISCORD_AVATAR: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          DISCORD_EMBEDS: >-
            [{
              "title": "ðŸŽ‰ Production Deployment Successful",
              "description": "New version is now live in production! ðŸš€",
              "color": 3066993,
              "thumbnail": {
                "url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
              },
              "fields": [
                {
                  "name": "ðŸ“¦ Repository",
                  "value": "SportGather/sportgather-ssc-dashboard",
                  "inline": true
                },
                {
                  "name": "ðŸŒ¿ Branch",
                  "value": "${{ github.ref_name }}",
                  "inline": true
                },
                {
                  "name": "ðŸ‘¤ Author",
                  "value": "${{ github.actor }}",
                  "inline": true
                },
                {
                  "name": "ðŸš€ Environment",
                  "value": "Production",
                  "inline": true
                },
                {
                  "name": "ðŸŒ Live URL",
                  "value": "[Visit Site](https://${{ env.PRODUCTION_DOMAIN }})",
                  "inline": true
                },
                {
                  "name": "ðŸ“… Deployed",
                  "value": "${{ github.event.head_commit.timestamp }}",
                  "inline": true
                },
                {
                  "name": "ðŸ’¬ Commit Message",
                  "value": "${{ github.event.head_commit.message }}",
                  "inline": false
                },
                {
                  "name": "ðŸ”— Commit Hash",
                  "value": "[`${{ github.sha }}`](${{ github.event.head_commit.url }})",
                  "inline": false
                }
              ],
              "footer": {
                "text": "SportGather CI/CD â€¢ Production",
                "icon_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
              },
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }]
        with: 
          args: '@here Production deployment success!'

  notify-failure:
    name: Failure Notification
    runs-on: ubuntu-latest
    if: failure()
    needs: [notify-success]
    steps:
      - name: Notify Discord - Failure
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_USERNAME: "SportGather CI/CD"
          DISCORD_EMBEDS: >-
            [{
              "title": "ðŸš¨ Production Deployment Failed",
              "description": "Deployment to production has failed and requires attention!",
              "color": 15158332,
              "fields": [
                {
                  "name": "ðŸ“¦ Repository",
                  "value": "${{ github.repository }}",
                  "inline": true
                },
                {
                  "name": "ðŸŒ¿ Branch",
                  "value": "${{ github.ref_name }}",
                  "inline": true
                },
                {
                  "name": "ðŸ‘¤ Author",
                  "value": "${{ github.actor }}",
                  "inline": true
                },
                {
                  "name": "ðŸ”— Workflow",
                  "value": "[View Logs](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})",
                  "inline": false
                }
              ],
              "footer": {
                "text": "SportGather CI/CD â€¢ Production Failed"
              },
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }]
        with:
          args: '@here Production deployment failed!'